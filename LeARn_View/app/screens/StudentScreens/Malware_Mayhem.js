import React, { useState, useEffect } from 'react';
import { View, Text, TouchableOpacity, StyleSheet, ScrollView, Image } from 'react-native';
import { LinearGradient } from 'expo-linear-gradient'; // Import the LinearGradient



const EASY_MALWARES = [
  {
    id: 1,
    description: 'A popup keeps appearing on your screen, telling you that your system is infected and urging you to download a "cleaner" program. What type of malware is this?',
    correctAnswer: 'Adware',
    options: ['Adware', 'Ransomware', 'Worm', 'Spyware'],
    image: require('./Malware/Virus.jpeg'),

  },
  {
    id: 2,
    description: 'After clicking on a suspicious email link, your files are encrypted, and a message appears demanding payment for the decryption key. What type of malware is this?',
    correctAnswer: 'Ransomware',
    options: ['Ransomware', 'Trojan', 'Spyware', 'Virus'],
    image: require('./Malware/Ransomware.webp'),

  },
  {
    id: 3,
    description: 'You download a free game, but after installing it, your computer starts running very slowly. It also redirects your browser to random websites. What type of malware could be responsible?',
    correctAnswer: 'Spyware',
    options: ['Spyware', 'Ransomware', 'Worm', 'Adware'],
    image: require('./Malware/Spyware.webp'),

  },
  {
    id: 4,
    description: 'A fake antivirus program install itself and keep running fake scans, claming your computer is infected. What is this malware called? ',
    correctAnswer: 'Scareware',
    options: ['Spyware', 'Ransomware', 'Worm', 'Scareware'],
    image: require('./Malware/Scareware.png'),

  },
  {
    id: 5,
    description: 'You receive an email that looks like its from your bank, asking you to click a link and update your password. Upon clicking, your data is stolen. What is this technique called?',
    correctAnswer: 'Phishing',
    options: ['Worm', 'Phishing', 'Worm', 'Trojen Horse'],
    image: require('./Malware/Phishing.jpeg'),

  },
  {
    id: 6,
    description: 'A USB drive found lying around is plugged into a computer, and shortly after, the computer is infected. What malware could have been spread this way? ',
    correctAnswer: 'Trojen Horse',
    options: ['Phising', 'Ransomware', 'Trojen Horse', 'Adware'],
    image: require('./Malware/trojen Horse.webp'),

  },
  {
    id: 7,
    description: 'You accidentally download a file that looks like an important document, but instead, it secretly installs harmful software on your computer. What is this type of malware? ',
    correctAnswer: 'Virus',
    options: ['Virus', 'Phising', 'Worm', 'Adware'],
    image: require('./Malware/Virus.jpeg'),

  },
  {
    id: 8,
    description: 'You visit a seemingly legitimate website, but after a few minutes, your computer is infected. What type of attack is this?',
    correctAnswer: ' Drive-by Download',
    options: ['Drive-by Download', 'Worm', 'Phising', 'Trojen Horse'],
    image: require('./Malware/Driveby.png'),

  },
  {
    id: 9,
    description: ' Your web browser’s homepage is changed to a strange website without your permission. What type of malware is responsible for this? ',
    correctAnswer: ' Browser Hijacker',
    options: ['Worm', 'Phising', 'Browser Hijacker', 'Virus'],
    image: require('./Malware/Browser-hijacker.webp'),

  },
  {
    id: 10,
    description: ' Your system is sending out spam emails without your knowledge. What type of malware could be responsible for this?',
    correctAnswer: 'Worm',
    options: ['Spyware', 'Worm', 'Virus', 'Adware'],
    image: require('./Malware/Worm.png'),

  },
];

const MEDIUM_MALWARES = [
  {
    id: 1,
    description: 'Your company’s network is infiltrated, and malware steals login credentials for multiple users, leading to unauthorized access. What type of malware specializes in this?',
    correctAnswer: 'Keylogger',
    options: ['Keylogger', 'Worm', 'Adware', 'Virus'],
    image: require('./Malware/Keylogger.png'),

  },
  {
    id: 2,
    description: 'An attacker installs malware that allows them to take complete control of your system remotely. What is this type of malware called?',
    correctAnswer: 'Remote Access Trojan (RAT)',
    options: ['Remote Access Trojan (RAT)', 'Adware', 'Ransomware', 'Virus'],
    image: require('./Malware/Virus.jpeg'),

  },
  {
    id: 3,
    description: 'You notice that your CPU usage is very high, and upon investigation, you find malware that’s using your computer to mine cryptocurrency. What is this called?',
    correctAnswer: 'Cryptojacker',
    options: ['Crytojacker','Remote Access Trojan (RAT)','Ransomware', 'Virus'],
    image: require('./Malware/Crytojacker.png'),

  },
  {
    id: 4,
    description: 'An email arrives containing an attachment that looks like an invoice, but opening it installs malware that spreads to other computers in the network. What is this called?',
    correctAnswer: 'Macro Virus',
    options: ['Adware', 'Ransomware', 'Virus', 'Macro Virus'],
    image: require('./Malware/MacroVirus.webp'),

  },
  {
    id: 5,
    description: ' A piece of malware hides its malicious code within a legitimate application, making it hard to detect. What type of malware is this? ',
    correctAnswer: 'Rootkit',
    options: [ 'Adware', 'Worm','Rootkit', 'Virus'],
    image: require('./Malware/Virus.jpeg'),

  },
  {
    id: 6,
    description: ' After opening a suspicious email attachment, your screen displays a message from a “hacker” group that takes responsibility for a coordinated malware attack. What type of attack could this be? ',
    correctAnswer: ' APT(Advanced Persistent Threat)',
    options: [ 'Adware', 'Ransomware', 'Virus', 'APT(Advanced Persistent Threat)'],
    image: require('./Malware/Virus.jpeg'),

  },
  {
    id: 7,
    description: 'Your network is hit with an attack that causes thousands of requests to flood your server, rendering it inaccessible. What type of attack is this?',
    correctAnswer: 'Distributed Denial of Service (DDoS)',
    options: ['Remote Access Trojan (RAT)', 'Distributed Denial of Service (DDoS)', 'Worm', 'Virus'],
    image: require('./Malware/DDoS.png'),

  },
  {
    id: 8,
    description: 'You discover malware on your system that uses multiple techniques to avoid detection by antivirus software. What is this type of malware called?', 
    correctAnswer: 'Polymorphic Virus',
    options: ['Remote Access Trojan (RAT)', 'Polymorphic Virus', 'Distributed Denial of Service (DDoS)', 'Virus'],
    image: require('./Malware/Polymorphic.png'),

  },
  {
    id: 9,
    description: 'You notice that sensitive company information has been leaked, and it is traced back to a backdoor malware installed by an external attacker. What is this type of malware called?',
    correctAnswer: 'Backdoor',
    options: ['Backdoor', 'Adware', 'Ransomware', 'Virus'],
    image: require('./Malware/Backdoor.jpg'),

  },
  {
    id: 10,
    description: 'Malware is discovered that automatically spreads itself across a network, using vulnerabilities in outdated software. What kind of malware could this be?',
    correctAnswer: 'Network worm',
    options: ['Virus', 'Adware', 'Ransomware', 'Networm worm'],
    image: require('./Malware/Networkworm.svg'),

  },
];

const HARD_MALWARES = [
  {
    id: 1,
    description: 'An attacker compromises a legitimate software update server and pushes a malicious update to thousands of users. This type of attack targets software supply chains. What is it called?',
    correctAnswer: 'Supply Chain Attack',
    options: ['Supply Chain Attack', 'Zero-Day Exploit', 'Keylogger', 'Virus'],
    image: require('./Malware/SupplyChain.png'),

  },
  {
    id: 2,
    description: 'Malware is found embedded within the firmware of a hardware device, allowing the attacker to persist across reboots and even OS reinstallations. What is this malware type?',
    correctAnswer: 'Firmware Malware',
    options: ['Firmware Malware', 'Virus', 'Spyware', 'Adware'],
    image: require('./Malware/Virus.jpeg'),

  },
  {
    id: 3,
    description: 'Your system is infected with malware that modifies its own code as it spreads, making it very difficult to detect with traditional signature-based antivirus solutions. What type of malware is this?',
    correctAnswer: 'Metamorphic Virus',
    options: [ 'Virus', 'Spyware', 'Adware', 'Metamorphic Virus'],
    image: require('./Malware/Virus.jpeg'),

  },
  {
    id: 4,
    description: 'A system is infected by malware that exploits zero-day vulnerabilities in an operating system, spreading rapidly before patches are available. What type of malware uses these flaws?',
    correctAnswer: 'Zero-Day Exploit',
    options: ['Firmware Malware', 'Zero-Day Exploit', 'Virus', 'Adware'],
    image: require('./Malware/Virus.jpeg'),

  },
  {
    id: 5,
    description: 'A company finds that malware has been slowly exfiltrating data over several months without being detected, typically aiming for long-term espionage. What type of attack is this?', 
    correctAnswer: 'Stealth Malware',
    options: ['Stealth Malware', 'Virus', 'Trohen Horse', 'Adware'],
    image: require('./Malware/Virus.jpeg'),

  },
  {
    id: 6,
    description: ' A malicious actor is able to infect a device with malware that activates only under specific conditions, such as geographic location or system behavior. What is this type of malware?',
    correctAnswer: 'Logic Bomb',
    options: ['Logic Bomb', 'Virus', 'Spyware', 'Adware'],
    image: require('./Malware/Virus.jpeg'),

  },
  {
    id: 7,
    description: 'You discover malware on your network that can automatically alter its behavior based on the security measures in place, such as firewalls or IDS (Intrusion Detection Systems). What type of malware could this be? ',
    correctAnswer: 'Firmware Malware',
    options: ['Firmware Malware', 'Virus', 'Adaptive Malware', 'Phishing'],
    image: require('./Malware/Virus.jpeg'),

  },
  {
    id: 8,
    description: ' A sophisticated attack installs malware that intercepts communication between the user and a legitimate website without alerting the user. What type of attack could this be?',
    correctAnswer: 'Man-in-the-Middle (MITM)',
    options: ['Man-in-the-Middle (MITM)', 'Firmware Malware', 'Virus', 'Adaptive Malware'],
    image: require('./Malware/MITM.png'),

  },
  {
    id: 9,
    description: 'Malware is detected on critical infrastructure systems like power grids, designed to disrupt services. What kind of malware targets industrial control systems?',
    correctAnswer: 'SCADA Malware',
    options: [ 'Virus', 'Spyware', 'Adware', 'SCADA Malware'],
    image: require('./Malware/SCADA.png'),

  },
  {
    id: 10,
    description: 'An organization is targeted by malware that uses encrypted communication channels to evade detection while receiving instructions from a command-and-control server. What is this technique called?',
    correctAnswer: 'C2 (Command and Control) Malware',
    options: ['Firmware Malware', 'C2 (Command and Control) Malware', 'Virus','Trojen Horse'],
    image: require('./Malware/C2Malware.png'),

  },
];
const getRandomQuestions = (difficultyLevel) => {
  const malwares = {
    easy: EASY_MALWARES,
    medium: MEDIUM_MALWARES,
    hard: HARD_MALWARES,
  };
  return malwares[difficultyLevel].sort(() => Math.random() - 0.5);
};

const MalwareGame = () => {
  const [difficulty, setDifficulty] = useState(null);
  const [malwares, setMalwares] = useState([]);
  const [currentMalware, setCurrentMalware] = useState(null);
  const [score, setScore] = useState(0);
  const [timeLeft, setTimeLeft] = useState(15);
  const [gameOver, setGameOver] = useState(false);
  const [questionIndex, setQuestionIndex] = useState(0);
  const [feedback, setFeedback] = useState(null); // State to hold feedback
  const [incorrectAnswers, setIncorrectAnswers] = useState([]);

  useEffect(() => {
    if (currentMalware && !gameOver) {
      const timer = setInterval(() => {
        setTimeLeft((prev) => {
          if (prev === 1) {
            handleNextQuestion(); // Move to next question if time runs out
            return 15;
          }
          return prev - 1;
        });
      }, 1000);
      return () => clearInterval(timer);
    }
  }, [currentMalware, gameOver]);

  const handleNextQuestion = () => {
    setFeedback(null); // Reset feedback when moving to next question
    if (questionIndex < malwares.length - 1) {
      setCurrentMalware(malwares[questionIndex + 1]);
      setTimeLeft(15);
      setQuestionIndex(questionIndex + 1);
    } else {
      setGameOver(true);
    }
  };

  const handleGuess = (guess) => {
    if (guess === currentMalware.correctAnswer) {
      setScore(score + 1);
      setFeedback('Correct!');
    } else {
      setIncorrectAnswers([...incorrectAnswers, {
        question: currentMalware.description,
        correctAnswer: currentMalware.correctAnswer,
      }]);
      setFeedback('Incorrect!');
    }
    // Automatically move to the next question after a delay
    setTimeout(handleNextQuestion, 2000);
  };

  const startGame = (selectedDifficulty) => {
    setDifficulty(selectedDifficulty);
    const randomQuestions = getRandomQuestions(selectedDifficulty);
    setMalwares(randomQuestions);
    setCurrentMalware(randomQuestions[0]);
    setScore(0);
    setQuestionIndex(0);
    setIncorrectAnswers([]);
    setGameOver(false);
    setTimeLeft(15);
    setFeedback(null);
  };

  const resetGame = () => {
    setDifficulty(null);
    setMalwares([]);
    setCurrentMalware(null);
    setScore(0);
    setGameOver(false);
    setQuestionIndex(0);
    setTimeLeft(15);
    setIncorrectAnswers([]);
    setFeedback(null);
  };

  return (
    <LinearGradient
      colors={['#141e30', '#243b55']} // Add gradient colors
      style={styles.linearGradient}   // Apply the gradient style
    >
      <ScrollView contentContainerStyle={styles.container}>
        {!difficulty ? (
          <View>
            <Text style={styles.title}>Select Difficulty Level</Text>
            <TouchableOpacity style={styles.button} onPress={() => startGame('easy')}>
              <Text style={styles.buttonText}>Easy</Text>
            </TouchableOpacity>
            <TouchableOpacity style={styles.button} onPress={() => startGame('medium')}>
              <Text style={styles.buttonText}>Medium</Text>
            </TouchableOpacity>
            <TouchableOpacity style={styles.button} onPress={() => startGame('hard')}>
              <Text style={styles.buttonText}>Hard</Text>
            </TouchableOpacity>
          </View>
        ) : gameOver ? (
          <View>
            <Text style={styles.title}>Game Over</Text>
            <Text style={styles.scoreText}>Your Score: {score}</Text>

            <Text style={styles.incorrectTitle}>Questions You Got Wrong:</Text>
            {incorrectAnswers.length > 0 ? (
              incorrectAnswers.map((item, index) => (
                <View key={index} style={styles.incorrectItem}>
                  <Text style={styles.incorrectQuestion}>
                    Q: {item.question}
                  </Text>
                  <Text style={styles.incorrectAnswer}>
                    Correct Answer: {item.correctAnswer}
                  </Text>
                </View>
              ))
            ) : (
              <Text style={styles.allCorrect}>You got all questions correct!</Text>
            )}

            <TouchableOpacity style={styles.button} onPress={resetGame}>
              <Text style={styles.buttonText}>Play Again</Text>
            </TouchableOpacity>
          </View>
        ) : currentMalware ? (
          <View style={styles.gameContainer}>
            <Image source={currentMalware.image} style={styles.malwareImage} />
            <Text style={styles.questionText}>{currentMalware.description}</Text>
            <View style={styles.optionsContainer}>
              {currentMalware.options.map((option, index) => (
                <TouchableOpacity
                  key={index}
                  style={styles.optionButton}
                  onPress={() => handleGuess(option)}
                  disabled={!!feedback} // Disable buttons after a guess is made
                >
                  <Text style={styles.optionButtonText}>{option}</Text>
                </TouchableOpacity>
              ))}
            </View>

            {/* Feedback for the answer */}
            {feedback && (
              <Text style={styles.feedbackText}>{feedback}</Text>
            )}

            <Text style={styles.timerText}>Time Left: {timeLeft} seconds</Text>
          </View>
        ) : null}
      </ScrollView>
    </LinearGradient>
  );
};

const styles = StyleSheet.create({
  linearGradient: {
    flex: 1,
    padding: 20,
    justifyContent: 'center',
  },
  container: {
    flexGrow: 1,
    justifyContent: 'center',
    alignItems: 'center',
  },
  title: {
    fontSize: 24,
    color: '#fff',
    textAlign: 'center',
    marginBottom: 20,
  },
  button: {
    backgroundColor: '#1f4068',
    paddingVertical: 10,
    paddingHorizontal: 20,
    borderRadius: 8,
    marginVertical: 10,
    alignItems: 'center',
  },
  buttonText: {
    color: '#fff',
    fontSize: 18,
  },
  gameContainer: {
    alignItems: 'center',
  },
  malwareImage: {
    width: 150,
    height: 150,
    marginBottom: 20,
  },
  questionText: {
    color: '#fff',
    fontSize: 18,
    textAlign: 'center',
    marginBottom: 20,
  },
  optionsContainer: {
    width: '100%',
  },
  optionButton: {
    backgroundColor: '#1f4068',
    paddingVertical: 10,
    paddingHorizontal: 20,
    borderRadius: 8,
    marginVertical: 5,
    alignItems: 'center',
  },
  optionButtonText: {
    color: '#fff',
    fontSize: 16,
  },
  feedbackText: {
    color: '#fff',
    fontSize: 20,
    textAlign: 'center',
    marginTop: 20,
  },
  timerText: {
    color: '#fff',
    fontSize: 16,
    marginTop: 20,
  },
  scoreText: {
    color: '#fff',
    fontSize: 20,
    textAlign: 'center',
    marginVertical: 10,
  },
  incorrectTitle: {
    fontSize: 18,
    color: '#ff4c4c',
    textAlign: 'center',
    marginTop: 20,
  },
  incorrectItem: {
    marginVertical: 10,
    backgroundColor: '#333',
    padding: 10,
    borderRadius: 8,
  },
  incorrectQuestion: {
    color: '#ff6b6b',
    fontSize: 16,
    textAlign: 'center',
  },
  incorrectAnswer: {
    color: '#fff',
    fontSize: 16,
    textAlign: 'center',
  },
  allCorrect: {
    color: '#4caf50',
    fontSize: 16,
    textAlign: 'center',
    marginTop: 10,
  },
});

export default MalwareGame;
